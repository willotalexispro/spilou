---
import { Container } from '@components/odyssey-theme';
import Layout from './Page.astro';
import { generateTagData } from '../utils/helpers';
import Breadcrumbs from '@components/blog/Breadcrumbs.astro';
import TableOfContents from '@components/blog/TableOfContents.astro';
import ShareButtons from '@components/blog/ShareButtons.astro';
import AuthorBox from '@components/blog/AuthorBox.astro';
import { defaultAuthor } from '../config/authors';
import settings from '../config/settings';

const {content: {title, description, publishDate, canonicalURL, featuredImage, tags, author}, headings} = Astro.props;

const authorId = author || defaultAuthor;
const canonicalUrl = canonicalURL || `${settings.url}${Astro.url.pathname}`;

let allTagsData = [];

if(tags && tags.length > 0){
  allTagsData = generateTagData(tags);
}

const seo = {
	title,
	description,
	publishDate,
	canonicalURL,
	image: featuredImage,
	type: 'article' as const,
};
---
<Layout seo={seo}>
  <div class="post-header__container">
    <h1>{title}</h1>
    <p class="post-layout__date">
      <time><em>{publishDate}</em></time>
    </p>
    {featuredImage && <img class="post-layout__img" src={featuredImage} alt={title} />}
  </div>
  <Breadcrumbs title={title} />
  <TableOfContents headings={headings} />
  <article id="article">
      <slot></slot>
  </article>
  {allTagsData.length > 0 && (
    <div class="post-tags__container">
      <div class="post-tags__list">
        {allTagsData.map(tag => (
          <a class="post-tags__tag" href={`/blog/tags/${tag.slug}`}>
            {tag.title}
          </a>
        ))}
      </div>
    </div>
  )}
  <ShareButtons url={canonicalUrl} title={title} />
  <AuthorBox authorId={authorId} />
</Layout>

<style>
  #article {
    max-width: var(--theme-blog-post-header-width);
    margin: 0 auto 3rem;
    padding: 2rem;
    background: var(--theme-bg);
    border-radius: var(--theme-shape-radius);
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
  }
  .post-header__container {
    max-width: var(--theme-blog-post-header-width);
    margin: 1rem auto;
    padding: 2rem;
    background: var(--theme-bg);
    border-radius: var(--theme-shape-radius);
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
  }
  .post-tags__container {
    max-width: var(--theme-blog-post-header-width);
    margin: 0 auto 1.5rem;
    padding: 0 2rem;
  }
  .post-tags__list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin: 0;
    padding: 0;
    list-style: none;
  }
  .post-tags__tag {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    padding: 0.2rem 0.6rem;
    border-radius: var(--theme-button-border-radius);
    background: var(--theme-surface-1);
    color: var(--theme-primary);
    text-decoration: none;
    transition: background var(--theme-transition), color var(--theme-transition);
  }
  .post-tags__tag:hover {
    background: var(--theme-primary);
    color: var(--theme-on-primary);
  }
  .post-layout__img {
    margin: 0 auto 1rem auto;
    border-radius: var(--theme-shape-radius);
  }
  .post-layout__date {
    margin-bottom: 1rem;
    opacity: 0.84;
  }
</style>
